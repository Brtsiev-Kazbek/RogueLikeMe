!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=10)}([function(t,e,i){"use strict";const r=2.3283064365386963e-10;class n{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*r,t=69069*t+1>>>0,this._s1=t*r,t=69069*t+1>>>0,this._s2=t*r,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*r;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),r=Math.min(t,e);return Math.floor(this.getUniform()*(i-r+1))+r}getNormal(t=0,e=1){let i,r,n;do{i=2*this.getUniform()-1,r=2*this.getUniform()-1,n=i*i+r*r}while(n>1||0==n);return t+i*Math.sqrt(-2*Math.log(n)/n)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let t=i.indexOf(this.getItem(i));e.push(i.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let i in t)e+=t[i];let i,r=this.getUniform()*e,n=0;for(i in t)if(n+=t[i],r<n)return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new n).setState(this.getState())}}e.a=(new n).setSeed(Date.now())},function(t,e,i){"use strict";function r(t,e){return(t%e+e)%e}function n(t,e=0,i=1){return t<e?e:t>i?i:t}function o(t){return t.charAt(0).toUpperCase()+t.substring(1)}function s(t,...e){let i=s.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,(function(r,n,s,l){if("%"==t.charAt(l-1))return r.substring(1);if(!e.length)return r;let a=e[0],h=(n||s).split(","),c=h.shift()||"",u=i[c.toLowerCase()];if(!u)return r;a=e.shift();let _=a[u].apply(a,h),f=c.charAt(0);return f!=f.toLowerCase()&&(_=o(_)),_}))}i.r(e),i.d(e,"mod",(function(){return r})),i.d(e,"clamp",(function(){return n})),i.d(e,"capitalize",(function(){return o})),i.d(e,"format",(function(){return s})),s.map={s:"toString"}},function(t,e,i){"use strict";i.r(e),i.d(e,"fromString",(function(){return o})),i.d(e,"add",(function(){return s})),i.d(e,"add_",(function(){return l})),i.d(e,"multiply",(function(){return a})),i.d(e,"multiply_",(function(){return h})),i.d(e,"interpolate",(function(){return c})),i.d(e,"lerp",(function(){return u})),i.d(e,"interpolateHSL",(function(){return _})),i.d(e,"lerpHSL",(function(){return f})),i.d(e,"randomize",(function(){return g})),i.d(e,"rgb2hsl",(function(){return d})),i.d(e,"hsl2rgb",(function(){return m})),i.d(e,"toRGB",(function(){return b})),i.d(e,"toHex",(function(){return E}));var r=i(1),n=i(0);function o(t){let e,i;if(t in R)e=R[t];else{if("#"==t.charAt(0)){let i=(t.match(/[0-9a-f]/gi)||[]).map(t=>parseInt(t,16));if(3==i.length)e=i.map(t=>17*t);else{for(let t=0;t<3;t++)i[t+1]+=16*i[t],i.splice(t,1);e=i}}else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map(t=>parseInt(t)):[0,0,0];R[t]=e}return e.slice()}function s(t,...e){let i=t.slice();for(let t=0;t<3;t++)for(let r=0;r<e.length;r++)i[t]+=e[r][t];return i}function l(t,...e){for(let i=0;i<3;i++)for(let r=0;r<e.length;r++)t[i]+=e[r][i];return t}function a(t,...e){let i=t.slice();for(let t=0;t<3;t++){for(let r=0;r<e.length;r++)i[t]*=e[r][t]/255;i[t]=Math.round(i[t])}return i}function h(t,...e){for(let i=0;i<3;i++){for(let r=0;r<e.length;r++)t[i]*=e[r][i]/255;t[i]=Math.round(t[i])}return t}function c(t,e,i=.5){let r=t.slice();for(let n=0;n<3;n++)r[n]=Math.round(r[n]+i*(e[n]-t[n]));return r}const u=c;function _(t,e,i=.5){let r=d(t),n=d(e);for(let t=0;t<3;t++)r[t]+=i*(n[t]-r[t]);return m(r)}const f=_;function g(t,e){e instanceof Array||(e=Math.round(n.a.getNormal(0,e)));let i=t.slice();for(let t=0;t<3;t++)i[t]+=e instanceof Array?Math.round(n.a.getNormal(0,e[t])):e;return i}function d(t){let e,i=t[0]/255,r=t[1]/255,n=t[2]/255,o=Math.max(i,r,n),s=Math.min(i,r,n),l=0,a=(o+s)/2;if(o==s)e=0;else{let t=o-s;switch(e=a>.5?t/(2-o-s):t/(o+s),o){case i:l=(r-n)/t+(r<n?6:0);break;case r:l=(n-i)/t+2;break;case n:l=(i-r)/t+4}l/=6}return[l,e,a]}function p(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function m(t){let e=t[2];if(0==t[1])return e=Math.round(255*e),[e,e,e];{let i=t[1],r=e<.5?e*(1+i):e+i-e*i,n=2*e-r,o=p(n,r,t[0]+1/3),s=p(n,r,t[0]),l=p(n,r,t[0]-1/3);return[Math.round(255*o),Math.round(255*s),Math.round(255*l)]}}function b(t){return`rgb(${t.map(t=>Object(r.clamp)(t,0,255)).join(",")})`}function E(t){return"#"+t.map(t=>Object(r.clamp)(t,0,255).toString(16).padStart(2,"0")).join("")}const R={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));class r{getContainer(){return null}setOptions(t){this._options=t}}},function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return s}));var r=i(3),n=i(2);function o(t){let e=n.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class s extends r.a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],i=this.computeSize();this._offset=i.map((t,i)=>Math.floor((t-e[i])/2))}clear(){t.stdout.write(`[0;48;5;${o(this._options.bg)}m[2J`)}draw(e,i){let[r,n,s,l,a]=e,h=this._offset[0]+r,c=this._offset[1]+n,u=this.computeSize();if(h<0||h>=u[0])return;if(c<0||c>=u[1])return;if(h===this._cursor[0]&&c===this._cursor[1]||(t.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(h,c)),this._cursor[0]=h,this._cursor[1]=c),i&&(s||(s=" ")),!s)return;let _=function(t,e){return`[0;38;5;${o(t)};48;5;${o(e)}m`}(l,a);if(_!==this._lastColor&&(t.stdout.write(_),this._lastColor=_),"\t"!=s){let e=[].concat(s);t.stdout.write(e[0])}this._cursor[0]++,this._cursor[0]>=u[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[t.stdout.columns,t.stdout.rows]}}}).call(this,i(9))},function(t,e,i){var r=i(6),n=i(7);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.i,n,""]]);var o={insert:"head",singleton:!1};r(n,o);t.exports=n.locals||{}},function(t,e,i){"use strict";var r,n=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},o=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),s=[];function l(t){for(var e=-1,i=0;i<s.length;i++)if(s[i].identifier===t){e=i;break}return e}function a(t,e){for(var i={},r=[],n=0;n<t.length;n++){var o=t[n],a=e.base?o[0]+e.base:o[0],h=i[a]||0,c="".concat(a," ").concat(h);i[a]=h+1;var u=l(c),_={css:o[1],media:o[2],sourceMap:o[3]};-1!==u?(s[u].references++,s[u].updater(_)):s.push({identifier:c,updater:p(_,e),references:1}),r.push(c)}return r}function h(t){var e=document.createElement("style"),r=t.attributes||{};if(void 0===r.nonce){var n=i.nc;n&&(r.nonce=n)}if(Object.keys(r).forEach((function(t){e.setAttribute(t,r[t])})),"function"==typeof t.insert)t.insert(e);else{var s=o(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function _(t,e,i,r){var n=i?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(t.styleSheet)t.styleSheet.cssText=u(e,n);else{var o=document.createTextNode(n),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function f(t,e,i){var r=i.css,n=i.media,o=i.sourceMap;if(n?t.setAttribute("media",n):t.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}var g=null,d=0;function p(t,e){var i,r,n;if(e.singleton){var o=d++;i=g||(g=h(e)),r=_.bind(null,i,o,!1),n=_.bind(null,i,o,!0)}else i=h(e),r=f.bind(null,i,e),n=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else n()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=n());var i=a(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var r=0;r<i.length;r++){var n=l(i[r]);s[n].references--}for(var o=a(t,e),h=0;h<i.length;h++){var c=l(i[h]);0===s[c].references&&(s[c].updater(),s.splice(c,1))}i=o}}}},function(t,e,i){(e=i(8)(!1)).push([t.i,"@import url(https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap);"]),e.push([t.i,"* {\r\n    box-sizing: border-box;\r\n}\r\n\r\nbody {\r\n    margin: 0;\r\n    line-height: 1.2;\r\n    /* font */\r\n    font-family: Montserrat, monospace;\r\n}\r\n",""]),t.exports=e},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",r=t[3];if(!r)return i;if(e&&"function"==typeof btoa){var n=(s=r,l=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(l),"/*# ".concat(a," */")),o=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(t," */")}));return[i].concat(o).concat([n]).join("\n")}var s,l,a;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,r){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(r)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(n[s]=!0)}for(var l=0;l<t.length;l++){var a=[].concat(t[l]);r&&n[a[0]]||(i&&(a[2]?a[2]="".concat(i," and ").concat(a[2]):a[2]=i),e.push(a))}},e}},function(t,e){var i,r,n=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var a,h=[],c=!1,u=-1;function _(){c&&a&&(c=!1,a.length?h=a.concat(h):u=-1,h.length&&f())}function f(){if(!c){var t=l(_);c=!0;for(var e=h.length;e;){for(a=h,h=[];++u<e;)a&&a[u].run();u=-1,e=h.length}a=null,c=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function d(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new g(t,e)),1!==h.length||c||l(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=d,n.addListener=d,n.once=d,n.off=d,n.removeListener=d,n.removeAllListeners=d,n.emit=d,n.prependListener=d,n.prependOnceListener=d,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e,i){"use strict";i.r(e);var r={};i.r(r),i.d(r,"TYPE_TEXT",(function(){return R})),i.d(r,"TYPE_NEWLINE",(function(){return T})),i.d(r,"TYPE_FG",(function(){return A})),i.d(r,"TYPE_BG",(function(){return y})),i.d(r,"measure",(function(){return v})),i.d(r,"tokenize",(function(){return S}));i(5);var n=i(0),o=i(3);class s extends o.a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?t.fontStyle+" ":""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,r=i.getBoundingClientRect();return t-=r.left,e-=r.top,t*=i.width/r.width,e*=i.height/r.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}var l=i(1);class a extends s{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[i,r,n,o,s]=t,l=[(i+1)*this._spacingX,r*this._spacingY+this._hexSize];if(this._options.transpose&&l.reverse(),e&&(this._ctx.fillStyle=s,this._fill(l[0],l[1])),!n)return;this._ctx.fillStyle=o;let a=[].concat(n);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],l[0],Math.ceil(l[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let i=2*t/((this._options.width+1)*Math.sqrt(3))-1,r=e/(2+1.5*(this._options.height-1)),n=Math.min(i,r),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let s=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let l=s/100;n=Math.floor(n)+1;let a=2*n/(this._options.spacing*(1+l/Math.sqrt(3)));return Math.ceil(a)-1}_normalizedEventToPosition(t,e){let i;this._options.transpose?(t+=e,t-=e=t-e,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let r=i/this._options.height;return e=Math.floor(e/r),Object(l.mod)(e,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let i=this._hexSize,r=this._options.border;const n=this._ctx;n.beginPath(),this._options.transpose?(n.moveTo(t-i+r,e),n.lineTo(t-i/2+r,e+this._spacingX-r),n.lineTo(t+i/2-r,e+this._spacingX-r),n.lineTo(t+i-r,e),n.lineTo(t+i/2-r,e-this._spacingX+r),n.lineTo(t-i/2+r,e-this._spacingX+r),n.lineTo(t-i+r,e)):(n.moveTo(t,e-i+r),n.lineTo(t+this._spacingX-r,e-i/2+r),n.lineTo(t+this._spacingX-r,e+i/2-r),n.lineTo(t,e+i-r),n.lineTo(t-this._spacingX+r,e+i/2-r),n.lineTo(t-this._spacingX+r,e-i/2+r),n.lineTo(t,e-i+r)),n.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let i,r;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(i="height",r="width"):(i="width",r="height"),this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[r]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}var h=(()=>{class t extends s{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(e,i){t.cache?this._drawWithCache(e):this._drawNoCache(e,i)}_drawWithCache(t){let e,[i,r,n,o,s]=t,l=""+n+o+s;if(l in this._canvasCache)e=this._canvasCache[l];else{let t=this._options.border;e=document.createElement("canvas");let i=e.getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,i.fillStyle=s,i.fillRect(t,t,e.width-t,e.height-t),n){i.fillStyle=o,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let t=[].concat(n);for(let e=0;e<t.length;e++)i.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[l]=e}this._ctx.drawImage(e,i*this._spacingX,r*this._spacingY)}_drawNoCache(t,e){let[i,r,n,o,s]=t;if(e){let t=this._options.border;this._ctx.fillStyle=s,this._ctx.fillRect(i*this._spacingX+t,r*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!n)return;this._ctx.fillStyle=o;let l=[].concat(n);for(let t=0;t<l.length;t++)this._ctx.fillText(l[t],(i+.5)*this._spacingX,Math.ceil((r+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),r=Math.floor(e/this._options.height),n=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=n;let s=o/100*r/i;return s>1&&(r=Math.floor(r/s)),Math.floor(r/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}return t.cache=!1,t})();class c extends s{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,r,n,o,s]=t,l=this._options.tileWidth,a=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*l,r*a,l,a):(this._ctx.fillStyle=s,this._ctx.fillRect(i*l,r*a,l,a))),!n)return;let h=[].concat(n),c=[].concat(o),u=[].concat(s);for(let t=0;t<h.length;t++){let e=this._options.tileMap[h[t]];if(!e)throw new Error(`Char "${h[t]}" not found in tileMap`);if(this._options.tileColorize){let n=this._colorCanvas,o=n.getContext("2d");o.globalCompositeOperation="source-over",o.clearRect(0,0,l,a);let s=c[t],h=u[t];o.drawImage(this._options.tileSet,e[0],e[1],l,a,0,0,l,a),"transparent"!=s&&(o.fillStyle=s,o.globalCompositeOperation="source-atop",o.fillRect(0,0,l,a)),"transparent"!=h&&(o.fillStyle=h,o.globalCompositeOperation="destination-over",o.fillRect(0,0,l,a)),this._ctx.drawImage(n,i*l,r*a,l,a)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],l,a,i*l,r*a,l,a)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}var u=i(2);class _ extends o.a{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",()=>this._updateTexture(e)):this._updateTexture(e)}draw(t,e){const i=this._gl,r=this._options;let[n,o,s,l,a]=t,h=i.canvas.height-(o+1)*r.tileHeight;if(i.scissor(n*r.tileWidth,h,r.tileWidth,r.tileHeight),e&&(r.tileColorize?i.clearColor(0,0,0,0):i.clearColor(...m(a)),i.clear(i.COLOR_BUFFER_BIT)),!s)return;let c=[].concat(s),u=[].concat(a),_=[].concat(l);i.uniform2fv(this._uniforms.targetPosRel,[n,o]);for(let t=0;t<c.length;t++){let e=this._options.tileMap[c[t]];if(!e)throw new Error(`Char "${c[t]}" not found in tileMap`);i.uniform1f(this._uniforms.colorize,r.tileColorize?1:0),i.uniform2fv(this._uniforms.tilesetPosAbs,e),r.tileColorize&&(i.uniform4fv(this._uniforms.tint,m(_[t])),i.uniform4fv(this._uniforms.bg,m(u[t]))),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...m(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let i=this._gl.canvas,r=i.getBoundingClientRect();return t-=r.left,e-=r.top,t*=i.width/r.width,e*=i.height/r.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,i){const r=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r)||"");const n=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n)||"");const o=t.createProgram();if(t.attachShader(o,r),t.attachShader(o,n),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(o)||"");return o}(t,g,d);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),f.forEach(i=>this._uniforms[i]=t.getUniformLocation(e,i)),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,i=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=i[0],t.canvas.height=i[1],t.viewport(0,0,i[0],i[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,i)}_updateTexture(t){!function(t,e){let i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const f=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],g="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),d="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let p={};function m(t){if(!(t in p)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else e=u.fromString(t).map(t=>t/255),e.push(1);p[t]=e}return p[t]}var b=i(4);const E=/%([bc]){([^}]*)}/g,R=0,T=1,A=2,y=3;function v(t,e){let i={width:0,height:1},r=S(t,e),n=0;for(let t=0;t<r.length;t++){let e=r[t];switch(e.type){case R:n+=e.value.length;break;case T:i.height++,i.width=Math.max(i.width,n),n=0}}return i.width=Math.max(i.width,n),i}function S(t,e){let i=[],r=0;t.replace(E,(function(e,n,o,s){let l=t.substring(r,s);return l.length&&i.push({type:R,value:l}),i.push({type:"c"==n?A:y,value:o.trim()}),r=s+e.length,""}));let n=t.substring(r);return n.length&&i.push({type:R,value:n}),function(t,e){e||(e=1/0);let i=0,r=0,n=-1;for(;i<t.length;){let o=t[i];if(o.type==T&&(r=0,n=-1),o.type!=R){i++;continue}for(;0==r&&" "==o.value.charAt(0);)o.value=o.value.substring(1);let s=o.value.indexOf("\n");if(-1!=s){o.value=w(t,i,s,!0);let e=o.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();o.value=e.join("")}if(o.value.length){if(r+o.value.length>e){let s=-1;for(;;){let t=o.value.indexOf(" ",s+1);if(-1==t)break;if(r+t>e)break;s=t}if(-1!=s)o.value=w(t,i,s,!0);else if(-1!=n){let e=t[n],r=e.value.lastIndexOf(" ");e.value=w(t,n,r,!0),i=n}else o.value=w(t,i,e-r,!1)}else r+=o.value.length,-1!=o.value.indexOf(" ")&&(n=i);i++}else t.splice(i,1)}t.push({type:T});let o=null;for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case R:o=i;break;case T:if(o){let t=o.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();o.value=t.join("")}o=null}}return t.pop(),t}(i,e)}function w(t,e,i,r){let n={type:T},o={type:R,value:t[e].value.substring(i+(r?1:0))};return t.splice(e+1,0,n,o),t[e].value.substring(0,i)}const M={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},I={hex:a,rect:h,tile:c,"tile-gl":_,term:b.a},x={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};var D=(()=>{class t{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},x,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let r=[this._options.bg,this._options.fg];this.draw(t,e,null,null,r[i%r.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=I[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,r,n){r||(r=this._options.fg),n||(n=this._options.bg);let o=`${t},${e}`;this._data[o]=[t,e,i,r,n],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[o]=!0)}drawText(t,e,i,r){let n=null,o=null,s=t,l=e,a=1;r||(r=this._options.width-t);let h=S(i,r);for(;h.length;){let e=h.shift();switch(e.type){case R:let i=!1,r=!1,h=!1,c=!1;for(let t=0;t<e.value.length;t++){let a=e.value.charCodeAt(t),u=e.value.charAt(t);if("term"===this._options.layout){let t=a>>8;if(17===t||t>=46&&t<=159||t>=172&&t<=215||a>=43360&&a<=43391){this.draw(s+0,l,u,n,o),this.draw(s+1,l,"\t",n,o),s+=2;continue}}h=a>65280&&a<65377||a>65500&&a<65512||a>65518,i=32==u.charCodeAt(0)||12288==u.charCodeAt(0),!c||h||i||s++,h&&!r&&s++,this.draw(s++,l,u,n,o),r=i,c=h}break;case A:n=e.value||null;break;case y:o=e.value||null;break;case T:s=t,l++,a++}}return a}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}return t.Rect=h,t.Hex=a,t.Tile=c,t.TileGL=_,t.Term=b.a,t})();class L{constructor(t,e={}){this._lightPasses=t,this._options=Object.assign({topology:8},e)}_getCircle(t,e,i){let r,n,o,s=[];switch(this._options.topology){case 4:n=1,o=[0,1],r=[M[8][7],M[8][1],M[8][3],M[8][5]];break;case 6:r=M[6],n=1,o=[-1,1];break;case 8:r=M[4],n=2,o=[-1,1];break;default:throw new Error("Incorrect topology for FOV computation")}let l=t+o[0]*i,a=e+o[1]*i;for(let t=0;t<r.length;t++)for(let e=0;e<i*n;e++)s.push([l,a]),l+=r[t][0],a+=r[t][1];return s}}const C=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];var k={DiscreteShadowcasting:class extends L{compute(t,e,i,r){if(r(t,e,0,1),!this._lightPasses(t,e))return;let n,o,s,l,a,h=[];for(let c=1;c<=i;c++){let i=this._getCircle(t,e,c),u=360/i.length;for(let t=0;t<i.length;t++)if(s=i[t][0],l=i[t][1],n=u*(t-.5),o=n+u,a=!this._lightPasses(s,l),this._visibleCoords(Math.floor(n),Math.ceil(o),a,h)&&r(s,l,c,1),2==h.length&&0==h[0]&&360==h[1])return}}_visibleCoords(t,e,i,r){if(t<0){let n=this._visibleCoords(0,e,i,r),o=this._visibleCoords(360+t,360,i,r);return n||o}let n=0;for(;n<r.length&&r[n]<t;)n++;if(n==r.length)return i&&r.push(t,e),!0;let o=0;if(n%2){for(;n<r.length&&r[n]<e;)n++,o++;return 0!=o&&(i&&(o%2?r.splice(n-o,o,e):r.splice(n-o,o)),!0)}for(;n<r.length&&r[n]<e;)n++,o++;return(t!=r[n-o]||1!=o)&&(i&&(o%2?r.splice(n-o,o,t):r.splice(n-o,o,t,e)),!0)}},PreciseShadowcasting:class extends L{compute(t,e,i,r){if(r(t,e,0,1),!this._lightPasses(t,e))return;let n,o,s,l,a,h,c=[];for(let u=1;u<=i;u++){let i=this._getCircle(t,e,u),_=i.length;for(let t=0;t<_;t++)if(n=i[t][0],o=i[t][1],l=[t?2*t-1:2*_-1,2*_],a=[2*t+1,2*_],s=!this._lightPasses(n,o),h=this._checkVisibility(l,a,s,c),h&&r(n,o,u,h),2==c.length&&0==c[0][0]&&c[1][0]==c[1][1])return}}_checkVisibility(t,e,i,r){if(t[0]>e[0]){return(this._checkVisibility(t,[t[1],t[1]],i,r)+this._checkVisibility([0,1],e,i,r))/2}let n=0,o=!1;for(;n<r.length;){let e=r[n],i=e[0]*t[1]-t[0]*e[1];if(i>=0){0!=i||n%2||(o=!0);break}n++}let s=r.length,l=!1;for(;s--;){let t=r[s],i=e[0]*t[1]-t[0]*e[1];if(i>=0){0==i&&s%2&&(l=!0);break}}let a,h=!0;if((n==s&&(o||l)||o&&l&&n+1==s&&s%2||n>s&&n%2)&&(h=!1),!h)return 0;let c=s-n+1;if(c%2)if(n%2){let t=r[n];a=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&r.splice(n,c,e)}else{let e=r[s];a=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&r.splice(n,c,t)}else{if(!(n%2))return i&&r.splice(n,c,t,e),1;{let t=r[n],e=r[s];a=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&r.splice(n,c)}}return a/((e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]))}},RecursiveShadowcasting:class extends L{compute(t,e,i,r){r(t,e,0,1);for(let n=0;n<C.length;n++)this._renderOctant(t,e,C[n],i,r)}compute180(t,e,i,r,n){n(t,e,0,1);let o=(r-1+8)%8,s=(r-2+8)%8,l=(r+1+8)%8;this._renderOctant(t,e,C[s],i,n),this._renderOctant(t,e,C[o],i,n),this._renderOctant(t,e,C[r],i,n),this._renderOctant(t,e,C[l],i,n)}compute90(t,e,i,r,n){n(t,e,0,1);let o=(r-1+8)%8;this._renderOctant(t,e,C[r],i,n),this._renderOctant(t,e,C[o],i,n)}_renderOctant(t,e,i,r,n){this._castVisibility(t,e,1,1,0,r+1,i[0],i[1],i[2],i[3],n)}_castVisibility(t,e,i,r,n,o,s,l,a,h,c){if(!(r<n))for(let u=i;u<=o;u++){let i=-u-1,_=-u,f=!1,g=0;for(;i<=0;){i+=1;let d=t+i*s+_*l,p=e+i*a+_*h,m=(i-.5)/(_+.5),b=(i+.5)/(_-.5);if(!(b>r)){if(m<n)break;if(i*i+_*_<o*o&&c(d,p,u,1),f){if(!this._lightPasses(d,p)){g=b;continue}f=!1,r=g}else!this._lightPasses(d,p)&&u<o&&(f=!0,this._castVisibility(t,e,u+1,r,m,o,s,l,a,h,c),g=b)}}if(f)break}}}};class O{constructor(t=80,e=25){this._width=t,this._height=e}_fillMap(t){let e=[];for(let i=0;i<this._width;i++){e.push([]);for(let r=0;r<this._height;r++)e[i].push(t)}return e}}class P extends O{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class U{}class H extends U{constructor(t,e,i,r,n,o){super(),this._x1=t,this._y1=e,this._x2=i,this._y2=r,this._doors={},void 0!==n&&void 0!==o&&this.addDoor(n,o)}static createRandomAt(t,e,i,r,o){let s=o.roomWidth[0],l=o.roomWidth[1],a=n.a.getUniformInt(s,l);s=o.roomHeight[0],l=o.roomHeight[1];let h=n.a.getUniformInt(s,l);if(1==i){let i=e-Math.floor(n.a.getUniform()*h);return new this(t+1,i,t+a,i+h-1,t,e)}if(-1==i){let i=e-Math.floor(n.a.getUniform()*h);return new this(t-a,i,t-1,i+h-1,t,e)}if(1==r){let i=t-Math.floor(n.a.getUniform()*a);return new this(i,e+1,i+a-1,e+h,t,e)}if(-1==r){let i=t-Math.floor(n.a.getUniform()*a);return new this(i,e-h,i+a-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,i){let r=i.roomWidth[0],o=i.roomWidth[1],s=n.a.getUniformInt(r,o);r=i.roomHeight[0],o=i.roomHeight[1];let l=n.a.getUniformInt(r,o),a=t-Math.floor(n.a.getUniform()*s),h=e-Math.floor(n.a.getUniform()*l);return new this(a,h,a+s-1,h+l-1)}static createRandom(t,e,i){let r=i.roomWidth[0],o=i.roomWidth[1],s=n.a.getUniformInt(r,o);r=i.roomHeight[0],o=i.roomHeight[1];let l=n.a.getUniformInt(r,o),a=t-s-1,h=e-l-1,c=1+Math.floor(n.a.getUniform()*a),u=1+Math.floor(n.a.getUniform()*h);return new this(c,u,c+s-1,u+l-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,i=this._x2+1,r=this._y1-1,n=this._y2+1;for(let o=e;o<=i;o++)for(let s=r;s<=n;s++)o!=e&&o!=i&&s!=r&&s!=n||t(o,s)||this.addDoor(o,s);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let i=this._x1-1,r=this._x2+1,n=this._y1-1,o=this._y2+1;for(let s=i;s<=r;s++)for(let l=n;l<=o;l++)if(s==i||s==r||l==n||l==o){if(!t(s,l))return!1}else if(!e(s,l))return!1;return!0}create(t){let e=this._x1-1,i=this._x2+1,r=this._y1-1,n=this._y2+1,o=0;for(let s=e;s<=i;s++)for(let l=r;l<=n;l++)o=s+","+l in this._doors?2:s==e||s==i||l==r||l==n?1:0,t(s,l,o)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class G extends U{constructor(t,e,i,r){super(),this._startX=t,this._startY=e,this._endX=i,this._endY=r,this._endsWithAWall=!0}static createRandomAt(t,e,i,r,o){let s=o.corridorLength[0],l=o.corridorLength[1],a=n.a.getUniformInt(s,l);return new this(t,e,t+i*a,e+r*a)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let i=this._startX,r=this._startY,n=this._endX-i,o=this._endY-r,s=1+Math.max(Math.abs(n),Math.abs(o));n&&(n/=Math.abs(n)),o&&(o/=Math.abs(o));let l=o,a=-n,h=!0;for(let c=0;c<s;c++){let u=i+c*n,_=r+c*o;if(e(u,_)||(h=!1),t(u+l,_+a)||(h=!1),t(u-l,_-a)||(h=!1),!h){s=c,this._endX=u-n,this._endY=_-o;break}}if(0==s)return!1;if(1==s&&t(this._endX+n,this._endY+o))return!1;let c=!t(this._endX+n+l,this._endY+o+a),u=!t(this._endX+n-l,this._endY+o-a);return this._endsWithAWall=t(this._endX+n,this._endY+o),!c&&!u||!this._endsWithAWall}create(t){let e=this._startX,i=this._startY,r=this._endX-e,n=this._endY-i,o=1+Math.max(Math.abs(r),Math.abs(n));r&&(r/=Math.abs(r)),n&&(n/=Math.abs(n));for(let s=0;s<o;s++){t(e+s*r,i+s*n,0)}return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,i=this._startY,r=this._endX-e,n=this._endY-i;r&&(r/=Math.abs(r)),n&&(n/=Math.abs(n));let o=n,s=-r;t(this._endX+r,this._endY+n),t(this._endX+o,this._endY+s),t(this._endX-o,this._endY-s)}}const K={room:H,corridor:G};function N(t,e,i){i[e[t+1]]=i[t],e[i[t]]=e[t+1],i[t]=t+1,e[t+1]=t}function W(t,e,i){i[e[t]]=i[t],e[i[t]]=e[t],i[t]=t,e[t]=t}var Y={Arena:class extends O{create(t){let e=this._width-1,i=this._height-1;for(let r=0;r<=e;r++)for(let n=0;n<=i;n++){t(r,n,r&&n&&r<e&&n<i?0:1)}return this}},Uniform:class extends P{constructor(t,e,i){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this}_generateRooms(){let t,e=this._width-2,i=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*i)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=H.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=n.a.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=n.a.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let i=this._closestRoom(this._connected,e);if(!i)break;if(!this._connectRooms(e,i))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let i=1/0,r=e.getCenter(),n=null;for(let e=0;e<t.length;e++){let o=t[e],s=o.getCenter(),l=s[0]-r[0],a=s[1]-r[1],h=l*l+a*a;h<i&&(i=h,n=o)}return n}_connectRooms(t,e){let i,r,n,o,s,l,a,h=t.getCenter(),c=e.getCenter(),u=c[0]-h[0],_=c[1]-h[1];if(Math.abs(u)<Math.abs(_)?(n=_>0?2:0,o=(n+2)%4,s=e.getLeft(),l=e.getRight(),a=0):(n=u>0?1:3,o=(n+2)%4,s=e.getTop(),l=e.getBottom(),a=1),i=this._placeInWall(t,n),!i)return!1;if(i[a]>=s&&i[a]<=l){r=i.slice();let t=0;switch(o){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}r[(a+1)%2]=t,this._digLine([i,r])}else if(i[a]<s-1||i[a]>l+1){let t=i[a]-c[a],n=0;switch(o){case 0:case 1:n=t<0?3:1;break;case 2:case 3:n=t<0?1:3}if(o=(o+n)%4,r=this._placeInWall(e,o),!r)return!1;let s=[0,0];s[a]=i[a];let l=(a+1)%2;s[l]=r[l],this._digLine([i,s,r])}else{let t=(a+1)%2;if(r=this._placeInWall(e,o),!r)return!1;let n=Math.round((r[t]+i[t])/2),s=[0,0],l=[0,0];s[a]=i[a],s[t]=n,l[a]=r[a],l[t]=n,this._digLine([i,s,l,r])}return t.addDoor(i[0],i[1]),e.addDoor(r[0],r[1]),a=this._unconnected.indexOf(t),-1!=a&&(this._unconnected.splice(a,1),this._connected.push(t)),a=this._unconnected.indexOf(e),-1!=a&&(this._unconnected.splice(a,1),this._connected.push(e)),!0}_placeInWall(t,e){let i=[0,0],r=[0,0],o=0;switch(e){case 0:r=[1,0],i=[t.getLeft(),t.getTop()-1],o=t.getRight()-t.getLeft()+1;break;case 1:r=[0,1],i=[t.getRight()+1,t.getTop()],o=t.getBottom()-t.getTop()+1;break;case 2:r=[1,0],i=[t.getLeft(),t.getBottom()+1],o=t.getRight()-t.getLeft()+1;break;case 3:r=[0,1],i=[t.getLeft()-1,t.getTop()],o=t.getBottom()-t.getTop()+1}let s=[],l=-2;for(let t=0;t<o;t++){let e=i[0]+t*r[0],n=i[1]+t*r[1];s.push(null),1==this._map[e][n]?l!=t-1&&(s[t]=[e,n]):(l=t,t&&(s[t-1]=null))}for(let t=s.length-1;t>=0;t--)s[t]||s.splice(t,1);return s.length?n.a.getItem(s):null}_digLine(t){for(let e=1;e<t.length;e++){let i=t[e-1],r=t[e],n=new G(i[0],i[1],r[0],r[1]);n.create(this._digCallback),this._corridors.push(n)}}_digCallback(t,e,i){this._map[t][e]=i,0==i&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}},Cellular:class extends O{constructor(t,e,i={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(i),this._dirs=M[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)this._map[e][i]=n.a.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,i){this._map[t][e]=i}create(t){let e=this._fillMap(0),i=this._options.born,r=this._options.survive;for(let t=0;t<this._height;t++){let n=1,o=0;6==this._options.topology&&(n=2,o=t%2);for(let s=o;s<this._width;s+=n){let n=this._map[s][t],o=this._getNeighbors(s,t);n&&-1!=r.indexOf(o)?e[s][t]=1:n||-1==i.indexOf(o)||(e[s][t]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let i=1,r=0;6==this._options.topology&&(i=2,r=e%2);for(let n=r;n<this._width;n+=i)t(n,e,this._map[n][e])}}_getNeighbors(t,e){let i=0;for(let r=0;r<this._dirs.length;r++){let n=this._dirs[r],o=t+n[0],s=e+n[1];o<0||o>=this._width||s<0||s>=this._height||(i+=1==this._map[o][s]?1:0)}return i}connect(t,e,i){e||(e=0);let r=[],o={},s=1,l=[0,0];6==this._options.topology&&(s=2,l=[0,1]);for(let t=0;t<this._height;t++)for(let i=l[t%2];i<this._width;i+=s)if(this._freeSpace(i,t,e)){let e=[i,t];o[this._pointKey(e)]=e,r.push([i,t])}let a=r[n.a.getUniformInt(0,r.length-1)],h=this._pointKey(a),c={};for(c[h]=a,delete o[h],this._findConnected(c,o,[a],!1,e);Object.keys(o).length>0;){let t=this._getFromTo(c,o),r=t[0],n=t[1],s={};s[this._pointKey(r)]=r,this._findConnected(s,o,[r],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,n,r,c,o,e,i);for(let t in s){let i=s[t];this._map[i[0]][i[1]]=e,c[t]=i,delete o[t]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let i,r=[0,0],o=[0,0],s=Object.keys(t),l=Object.keys(e);for(let a=0;a<5;a++){if(s.length<l.length){let i=s;o=t[i[n.a.getUniformInt(0,i.length-1)]],r=this._getClosest(o,e)}else{let i=l;r=e[i[n.a.getUniformInt(0,i.length-1)]],o=this._getClosest(r,t)}if(i=(r[0]-o[0])*(r[0]-o[0])+(r[1]-o[1])*(r[1]-o[1]),i<64)break}return[r,o]}_getClosest(t,e){let i=null,r=null;for(let n in e){let o=e[n],s=(o[0]-t[0])*(o[0]-t[0])+(o[1]-t[1])*(o[1]-t[1]);(null==r||s<r)&&(r=s,i=o)}return i}_findConnected(t,e,i,r,n){for(;i.length>0;){let o,s=i.splice(0,1)[0];o=6==this._options.topology?[[s[0]+2,s[1]],[s[0]+1,s[1]-1],[s[0]-1,s[1]-1],[s[0]-2,s[1]],[s[0]-1,s[1]+1],[s[0]+1,s[1]+1]]:[[s[0]+1,s[1]],[s[0]-1,s[1]],[s[0],s[1]+1],[s[0],s[1]-1]];for(let s=0;s<o.length;s++){let l=this._pointKey(o[s]);null==t[l]&&this._freeSpace(o[s][0],o[s][1],n)&&(t[l]=o[s],r||delete e[l],i.push(o[s]))}}}_tunnelToConnected(t,e,i,r,n,o){let s,l;e[0]<t[0]?(s=e,l=t):(s=t,l=e);for(let t=s[0];t<=l[0];t++){this._map[t][s[1]]=n;let e=[t,s[1]],o=this._pointKey(e);i[o]=e,delete r[o]}o&&s[0]<l[0]&&o(s,[l[0],s[1]]);let a=l[0];e[1]<t[1]?(s=e,l=t):(s=t,l=e);for(let t=s[1];t<l[1];t++){this._map[a][t]=n;let e=[a,t],o=this._pointKey(e);i[o]=e,delete r[o]}o&&s[1]<l[1]&&o([l[0],s[1]],[l[0],l[1]])}_tunnelToConnected6(t,e,i,r,n,o){let s,l;e[0]<t[0]?(s=e,l=t):(s=t,l=e);let a=s[0],h=s[1];for(;a!=l[0]||h!=l[1];){let t=2;h<l[1]?(h++,t=1):h>l[1]&&(h--,t=1),a<l[0]?a+=t:a>l[0]||l[1]%2?a-=t:a+=t,this._map[a][h]=n;let e=[a,h],o=this._pointKey(e);i[o]=e,delete r[o]}o&&o(e,t)}_freeSpace(t,e,i){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==i}_pointKey(t){return t[0]+"."+t[1]}},Digger:class extends P{constructor(t,e,i={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},i),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let i,r=Date.now();do{if(i=0,Date.now()-r>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let e=t.split(","),n=parseInt(e[0]),o=parseInt(e[1]),s=this._getDiggingDirection(n,o);if(!s)continue;let l=0;do{if(l++,this._tryFeature(n,o,s[0],s[1])){this._removeSurroundingWalls(n,o),this._removeSurroundingWalls(n-s[0],o-s[1]);break}}while(l<this._featureAttempts);for(let t in this._walls)this._walls[t]>1&&i++}while(this._dug/e<this._options.dugPercentage||i);if(this._addDoors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this._walls={},this._map=[],this}_digCallback(t,e,i){0==i||2==i?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),i=H.createRandomCenter(t,e,this._options);this._rooms.push(i),i.create(this._digCallback)}_findWall(){let t=[],e=[];for(let i in this._walls){2==this._walls[i]?e.push(i):t.push(i)}let i=e.length?e:t;if(!i.length)return null;let r=n.a.getItem(i.sort());return delete this._walls[r],r}_tryFeature(t,e,i,r){let o=n.a.getWeightedValue(this._features),s=K[o].createRandomAt(t,e,i,r,this._options);return!!s.isValid(this._isWallCallback,this._canBeDugCallback)&&(s.create(this._digCallback),s instanceof H&&this._rooms.push(s),s instanceof G&&(s.createPriorityWalls(this._priorityWallCallback),this._corridors.push(s)),!0)}_removeSurroundingWalls(t,e){let i=M[4];for(let r=0;r<i.length;r++){let n=i[r],o=t+n[0],s=e+n[1];delete this._walls[o+","+s],o=t+2*n[0],s=e+2*n[1],delete this._walls[o+","+s]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let i=null,r=M[4];for(let n=0;n<r.length;n++){let o=r[n],s=t+o[0],l=e+o[1];if(!this._map[s][l]){if(i)return null;i=o}}return i?[-i[0],-i[1]]:null}_addDoors(){let t=this._map;function e(e,i){return 1==t[e][i]}for(let t=0;t<this._rooms.length;t++){let i=this._rooms[t];i.clearDoors(),i.addDoors(e)}}},EllerMaze:class extends O{create(t){let e,i=this._fillMap(1),r=Math.ceil((this._width-2)/2),o=[],s=[];for(let t=0;t<r;t++)o.push(t),s.push(t);for(o.push(r-1),e=1;e+3<this._height;e+=2)for(let t=0;t<r;t++){let r=2*t+1,l=e;i[r][l]=0,t!=o[t+1]&&n.a.getUniform()>9/24&&(N(t,o,s),i[r+1][l]=0),t!=o[t]&&n.a.getUniform()>9/24?W(t,o,s):i[r][l+1]=0}for(let t=0;t<r;t++){let r=2*t+1,l=e;i[r][l]=0,t!=o[t+1]&&(t==o[t]||n.a.getUniform()>9/24)&&(N(t,o,s),i[r+1][l]=0),W(t,o,s)}for(let e=0;e<this._width;e++)for(let r=0;r<this._height;r++)t(e,r,i[e][r]);return this}},DividedMaze:class extends O{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,i=this._height;this._map=[];for(let t=0;t<e;t++){this._map.push([]);for(let r=0;r<i;r++){let n=0==t||0==r||t+1==e||r+1==i;this._map[t].push(n?1:0)}}this._stack=[[1,1,e-2,i-2]],this._process();for(let r=0;r<e;r++)for(let e=0;e<i;e++)t(r,e,this._map[r][e]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],i=[];for(let i=t[0]+1;i<t[2];i++){let r=this._map[i][t[1]-1],n=this._map[i][t[3]+1];!r||!n||i%2||e.push(i)}for(let e=t[1]+1;e<t[3];e++){let r=this._map[t[0]-1][e],n=this._map[t[2]+1][e];!r||!n||e%2||i.push(e)}if(!e.length||!i.length)return;let r=n.a.getItem(e),o=n.a.getItem(i);this._map[r][o]=1;let s=[],l=[];s.push(l);for(let e=t[0];e<r;e++)this._map[e][o]=1,e%2&&l.push([e,o]);l=[],s.push(l);for(let e=r+1;e<=t[2];e++)this._map[e][o]=1,e%2&&l.push([e,o]);l=[],s.push(l);for(let e=t[1];e<o;e++)this._map[r][e]=1,e%2&&l.push([r,e]);l=[],s.push(l);for(let e=o+1;e<=t[3];e++)this._map[r][e]=1,e%2&&l.push([r,e]);let a=n.a.getItem(s);for(let t=0;t<s.length;t++){let e=s[t];if(e==a)continue;let i=n.a.getItem(e);this._map[i[0]][i[1]]=0}this._stack.push([t[0],t[1],r-1,o-1]),this._stack.push([r+1,t[1],t[2],o-1]),this._stack.push([t[0],o+1,r-1,t[3]]),this._stack.push([r+1,o+1,t[2],t[3]])}},IceyMaze:class extends O{constructor(t,e,i=0){super(t,e),this._regularity=i,this._map=[]}create(t){let e=this._width,i=this._height,r=this._fillMap(1);e-=e%2?1:2,i-=i%2?1:2;let o=0,s=0,l=0,a=0,h=0,c=!1,u=[[0,0],[0,0],[0,0],[0,0]];do{if(o=1+2*Math.floor(n.a.getUniform()*(e-1)/2),s=1+2*Math.floor(n.a.getUniform()*(i-1)/2),h||(r[o][s]=0),!r[o][s]){this._randomize(u);do{0==Math.floor(n.a.getUniform()*(this._regularity+1))&&this._randomize(u),c=!0;for(let t=0;t<4;t++)if(l=o+2*u[t][0],a=s+2*u[t][1],this._isFree(r,l,a,e,i)){r[l][a]=0,r[o+u[t][0]][s+u[t][1]]=0,o=l,s=a,c=!1,h++;break}}while(!c)}}while(h+1<e*i/4);for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,r[e][i]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*n.a.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}}_isFree(t,e,i,r,n){return!(e<1||i<1||e>=r||i>=n)&&t[e][i]}},Rogue:class extends O{constructor(t,e,i){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],(i=Object.assign({cellWidth:3,cellHeight:3},i)).hasOwnProperty("roomWidth")||(i.roomWidth=this._calculateRoomSize(this._width,i.cellWidth)),i.hasOwnProperty("roomHeight")||(i.roomHeight=this._calculateRoomSize(this._height,i.cellHeight)),this._options=i}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this.map[e][i]);return this}_calculateRoomSize(t,e){let i=Math.floor(t/e*.8),r=Math.floor(t/e*.25);return r<2&&(r=2),i<2&&(i=2),[r,i]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t,e,i,r,o,s,l=n.a.getUniformInt(0,this._options.cellWidth-1),a=n.a.getUniformInt(0,this._options.cellHeight-1),h=!1;do{s=[0,2,4,6],s=n.a.shuffle(s);do{if(h=!1,t=s.pop(),e=l+M[8][t][0],i=a+M[8][t][1],!(e<0||e>=this._options.cellWidth||i<0||i>=this._options.cellHeight)){if(r=this.rooms[l][a],r.connections.length>0&&r.connections[0][0]==e&&r.connections[0][1]==i)break;o=this.rooms[e][i],0==o.connections.length&&(o.connections.push([l,a]),this.connectedCells.push([e,i]),l=e,a=i,h=!0)}}while(s.length>0&&0==h)}while(s.length>0)}_connectUnconnectedRooms(){let t,e,i,r=this._options.cellWidth,o=this._options.cellHeight;this.connectedCells=n.a.shuffle(this.connectedCells);for(let s=0;s<this._options.cellWidth;s++)for(let l=0;l<this._options.cellHeight;l++)if(t=this.rooms[s][l],0==t.connections.length){let a=[0,2,4,6];a=n.a.shuffle(a),i=!1;do{let t=a.pop(),n=s+M[8][t][0],h=l+M[8][t][1];if(!(n<0||n>=r||h<0||h>=o)){if(e=this.rooms[n][h],i=!0,0==e.connections.length)break;for(let t=0;t<e.connections.length;t++)if(e.connections[t][0]==s&&e.connections[t][1]==l){i=!1;break}if(i)break}}while(a.length);i?t.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,i,r,o,s=this._width,l=this._height,a=this._options.cellWidth,h=this._options.cellHeight,c=Math.floor(this._width/a),u=Math.floor(this._height/h),_=this._options.roomWidth,f=this._options.roomHeight;for(let g=0;g<a;g++)for(let a=0;a<h;a++){if(i=c*g,r=u*a,0==i&&(i=1),0==r&&(r=1),t=n.a.getUniformInt(_[0],_[1]),e=n.a.getUniformInt(f[0],f[1]),a>0)for(o=this.rooms[g][a-1];r-(o.y+o.height)<3;)r++;if(g>0)for(o=this.rooms[g-1][a];i-(o.x+o.width)<3;)i++;let h=Math.round(n.a.getUniformInt(0,c-t)/2),d=Math.round(n.a.getUniformInt(0,u-e)/2);for(;i+h+t>=s;)h?h--:t--;for(;r+d+e>=l;)d?d--:e--;i+=h,r+=d,this.rooms[g][a].x=i,this.rooms[g][a].y=r,this.rooms[g][a].width=t,this.rooms[g][a].height=e;for(let n=i;n<i+t;n++)for(let t=r;t<r+e;t++)this.map[n][t]=0}}_getWallPosition(t,e){let i,r,o;return 1==e||3==e?(i=n.a.getUniformInt(t.x+1,t.x+t.width-2),1==e?(r=t.y-2,o=r+1):(r=t.y+t.height+1,o=r-1),this.map[i][o]=0):(r=n.a.getUniformInt(t.y+1,t.y+t.height-2),2==e?(i=t.x+t.width+1,o=i-1):(i=t.x-2,o=i+1),this.map[o][r]=0),[i,r]}_drawCorridor(t,e){let i,r,o,s,l=e[0]-t[0],a=e[1]-t[1],h=t[0],c=t[1],u=[],_=Math.abs(l),f=Math.abs(a),g=n.a.getUniform(),d=g,p=1-g;for(r=l>0?2:6,o=a>0?4:0,_<f?(i=Math.ceil(f*d),u.push([o,i]),u.push([r,_]),i=Math.floor(f*p),u.push([o,i])):(i=Math.ceil(_*d),u.push([r,i]),u.push([o,f]),i=Math.floor(_*p),u.push([r,i])),this.map[h][c]=0;u.length>0;)for(s=u.pop();s[1]>0;)h+=M[8][s[0]][0],c+=M[8][s[0]][1],this.map[h][c]=0,s[1]=s[1]-1}_createCorridors(){let t,e,i,r,n,o=this._options.cellWidth,s=this._options.cellHeight;for(let l=0;l<o;l++)for(let o=0;o<s;o++){t=this.rooms[l][o];for(let o=0;o<t.connections.length;o++)e=t.connections[o],i=this.rooms[e[0]][e[1]],i.cellx>t.cellx?(r=2,n=4):i.cellx<t.cellx?(r=4,n=2):i.celly>t.celly?(r=3,n=1):(r=1,n=3),this._drawCorridor(this._getWallPosition(t,r),this._getWallPosition(i,n))}}}};Math.sqrt(3),Math.sqrt(3);var z={MAP_WIDTH:80,MAP_HEIGHT:45,fontFamily:"monospace"},B={BLACK:"rgb(0,0,0)",DARKEST_GREY:"rgb(31,31,31)",DARKER_GREY:"rgb(63,63,63)",DARK_GREY:"rgb(95,95,95)",GREY:"rgb(127,127,127)",LIGHT_GREY:"rgb(159,159,159)",LIGHTER_GREY:"rgb(191,191,191)",LIGHTEST_GREY:"rgb(223,223,223)",DARKEST_GRAY:"rgb(31,31,31)",DARKER_GRAY:"rgb(63,63,63)",DARK_GRAY:"rgb(95,95,95)",GRAY:"rgb(127,127,127)",LIGHT_GRAY:"rgb(159,159,159)",LIGHTER_GRAY:"rgb(191,191,191)",LIGHTEST_GRAY:"rgb(223,223,223)",WHITE:"rgb(255,255,255)",DARKEST_SEPIA:"rgb(31,24,15)",DARKER_SEPIA:"rgb(63,50,31)",DARK_SEPIA:"rgb(94,75,47)",SEPIA:"rgb(127,101,63)",LIGHT_SEPIA:"rgb(158,134,100)",LIGHTER_SEPIA:"rgb(191,171,143)",LIGHTEST_SEPIA:"rgb(222,211,195)",RED:"rgb(255,0,0)",FLAME:"rgb(255,63,0)",ORANGE:"rgb(255,127,0)",AMBER:"rgb(255,191,0)",YELLOW:"rgb(255,255,0)",LIME:"rgb(191,255,0)",CHARTREUSE:"rgb(127,255,0)",GREEN:"rgb(0,255,0)",SEA:"rgb(0,255,127)",TURQUOISE:"rgb(0,255,191)",CYAN:"rgb(0,255,255)",SKY:"rgb(0,191,255)",AZURE:"rgb(0,127,255)",BLUE:"rgb(0,0,255)",HAN:"rgb(63,0,255)",VIOLET:"rgb(127,0,255)",PURPLE:"rgb(191,0,255)",FUCHSIA:"rgb(255,0,255)",MAGENTA:"rgb(255,0,191)",PINK:"rgb(255,0,127)",CRIMSON:"rgb(255,0,63)",DARK_RED:"rgb(191,0,0)",DARK_FLAME:"rgb(191,47,0)",DARK_ORANGE:"rgb(191,95,0)",DARK_AMBER:"rgb(191,143,0)",DARK_YELLOW:"rgb(191,191,0)",DARK_LIME:"rgb(143,191,0)",DARK_CHARTREUSE:"rgb(95,191,0)",DARK_GREEN:"rgb(0,191,0)",DARK_SEA:"rgb(0,191,95)",DARK_TURQUOISE:"rgb(0,191,143)",DARK_CYAN:"rgb(0,191,191)",DARK_SKY:"rgb(0,143,191)",DARK_AZURE:"rgb(0,95,191)",DARK_BLUE:"rgb(0,0,191)",DARK_HAN:"rgb(47,0,191)",DARK_VIOLET:"rgb(95,0,191)",DARK_PURPLE:"rgb(143,0,191)",DARK_FUCHSIA:"rgb(191,0,191)",DARK_MAGENTA:"rgb(191,0,143)",DARK_PINK:"rgb(191,0,95)",DARK_CRIMSON:"rgb(191,0,47)",DARKER_RED:"rgb(127,0,0)",DARKER_FLAME:"rgb(127,31,0)",DARKER_ORANGE:"rgb(127,63,0)",DARKER_AMBER:"rgb(127,95,0)",DARKER_YELLOW:"rgb(127,127,0)",DARKER_LIME:"rgb(95,127,0)",DARKER_CHARTREUSE:"rgb(63,127,0)",DARKER_GREEN:"rgb(0,127,0)",DARKER_SEA:"rgb(0,127,63)",DARKER_TURQUOISE:"rgb(0,127,95)",DARKER_CYAN:"rgb(0,127,127)",DARKER_SKY:"rgb(0,95,127)",DARKER_AZURE:"rgb(0,63,127)",DARKER_BLUE:"rgb(0,0,127)",DARKER_HAN:"rgb(31,0,127)",DARKER_VIOLET:"rgb(63,0,127)",DARKER_PURPLE:"rgb(95,0,127)",DARKER_FUCHSIA:"rgb(127,0,127)",DARKER_MAGENTA:"rgb(127,0,95)",DARKER_PINK:"rgb(127,0,63)",DARKER_CRIMSON:"rgb(127,0,31)",DARKEST_RED:"rgb(63,0,0)",DARKEST_FLAME:"rgb(63,15,0)",DARKEST_ORANGE:"rgb(63,31,0)",DARKEST_AMBER:"rgb(63,47,0)",DARKEST_YELLOW:"rgb(63,63,0)",DARKEST_LIME:"rgb(47,63,0)",DARKEST_CHARTREUSE:"rgb(31,63,0)",DARKEST_GREEN:"rgb(0,63,0)",DARKEST_SEA:"rgb(0,63,31)",DARKEST_TURQUOISE:"rgb(0,63,47)",DARKEST_CYAN:"rgb(0,63,63)",DARKEST_SKY:"rgb(0,47,63)",DARKEST_AZURE:"rgb(0,31,63)",DARKEST_BLUE:"rgb(0,0,63)",DARKEST_HAN:"rgb(15,0,63)",DARKEST_VIOLET:"rgb(31,0,63)",DARKEST_PURPLE:"rgb(47,0,63)",DARKEST_FUCHSIA:"rgb(63,0,63)",DARKEST_MAGENTA:"rgb(63,0,47)",DARKEST_PINK:"rgb(63,0,31)",DARKEST_CRIMSON:"rgb(63,0,15)",LIGHT_RED:"rgb(255,114,114)",LIGHT_FLAME:"rgb(255,149,114)",LIGHT_ORANGE:"rgb(255,184,114)",LIGHT_AMBER:"rgb(255,219,114)",LIGHT_YELLOW:"rgb(255,255,114)",LIGHT_LIME:"rgb(219,255,114)",LIGHT_CHARTREUSE:"rgb(184,255,114)",LIGHT_GREEN:"rgb(114,255,114)",LIGHT_SEA:"rgb(114,255,184)",LIGHT_TURQUOISE:"rgb(114,255,219)",LIGHT_CYAN:"rgb(114,255,255)",LIGHT_SKY:"rgb(114,219,255)",LIGHT_AZURE:"rgb(114,184,255)",LIGHT_BLUE:"rgb(114,114,255)",LIGHT_HAN:"rgb(149,114,255)",LIGHT_VIOLET:"rgb(184,114,255)",LIGHT_PURPLE:"rgb(219,114,255)",LIGHT_FUCHSIA:"rgb(255,114,255)",LIGHT_MAGENTA:"rgb(255,114,219)",LIGHT_PINK:"rgb(255,114,184)",LIGHT_CRIMSON:"rgb(255,114,149)",LIGHTER_RED:"rgb(255,165,165)",LIGHTER_FLAME:"rgb(255,188,165)",LIGHTER_ORANGE:"rgb(255,210,165)",LIGHTER_AMBER:"rgb(255,232,165)",LIGHTER_YELLOW:"rgb(255,255,165)",LIGHTER_LIME:"rgb(232,255,165)",LIGHTER_CHARTREUSE:"rgb(210,255,165)",LIGHTER_GREEN:"rgb(165,255,165)",LIGHTER_SEA:"rgb(165,255,210)",LIGHTER_TURQUOISE:"rgb(165,255,232)",LIGHTER_CYAN:"rgb(165,255,255)",LIGHTER_SKY:"rgb(165,232,255)",LIGHTER_AZURE:"rgb(165,210,255)",LIGHTER_BLUE:"rgb(165,165,255)",LIGHTER_HAN:"rgb(188,165,255)",LIGHTER_VIOLET:"rgb(210,165,255)",LIGHTER_PURPLE:"rgb(232,165,255)",LIGHTER_FUCHSIA:"rgb(255,165,255)",LIGHTER_MAGENTA:"rgb(255,165,232)",LIGHTER_PINK:"rgb(255,165,210)",LIGHTER_CRIMSON:"rgb(255,165,188)",LIGHTEST_RED:"rgb(255,191,191)",LIGHTEST_FLAME:"rgb(255,207,191)",LIGHTEST_ORANGE:"rgb(255,223,191)",LIGHTEST_AMBER:"rgb(255,239,191)",LIGHTEST_YELLOW:"rgb(255,255,191)",LIGHTEST_LIME:"rgb(239,255,191)",LIGHTEST_CHARTREUSE:"rgb(223,255,191)",LIGHTEST_GREEN:"rgb(191,255,191)",LIGHTEST_SEA:"rgb(191,255,223)",LIGHTEST_TURQUOISE:"rgb(191,255,239)",LIGHTEST_CYAN:"rgb(191,255,255)",LIGHTEST_SKY:"rgb(191,239,255)",LIGHTEST_AZURE:"rgb(191,223,255)",LIGHTEST_BLUE:"rgb(191,191,255)",LIGHTEST_HAN:"rgb(207,191,255)",LIGHTEST_VIOLET:"rgb(223,191,255)",LIGHTEST_PURPLE:"rgb(239,191,255)",LIGHTEST_FUCHSIA:"rgb(255,191,255)",LIGHTEST_MAGENTA:"rgb(255,191,239)",LIGHTEST_PINK:"rgb(255,191,223)",LIGHTEST_CRIMSON:"rgb(255,191,207)",DESATURATED_RED:"rgb(127,63,63)",DESATURATED_FLAME:"rgb(127,79,63)",DESATURATED_ORANGE:"rgb(127,95,63)",DESATURATED_AMBER:"rgb(127,111,63)",DESATURATED_YELLOW:"rgb(127,127,63)",DESATURATED_LIME:"rgb(111,127,63)",DESATURATED_CHARTREUSE:"rgb(95,127,63)",DESATURATED_GREEN:"rgb(63,127,63)",DESATURATED_SEA:"rgb(63,127,95)",DESATURATED_TURQUOISE:"rgb(63,127,111)",DESATURATED_CYAN:"rgb(63,127,127)",DESATURATED_SKY:"rgb(63,111,127)",DESATURATED_AZURE:"rgb(63,95,127)",DESATURATED_BLUE:"rgb(63,63,127)",DESATURATED_HAN:"rgb(79,63,127)",DESATURATED_VIOLET:"rgb(95,63,127)",DESATURATED_PURPLE:"rgb(111,63,127)",DESATURATED_FUCHSIA:"rgb(127,63,127)",DESATURATED_MAGENTA:"rgb(127,63,111)",DESATURATED_PINK:"rgb(127,63,95)",DESATURATED_CRIMSON:"rgb(127,63,79)",BRASS:"rgb(191,151,96)",COPPER:"rgb(197,136,124)",GOLD:"rgb(229,191,0)",SILVER:"rgb(203,203,203)",CELADON:"rgb(172,255,175)",PEACH:"rgb(255,159,127)"};function X(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return j(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return j(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(l)throw o}}}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var F=B.DARKER_BLUE,V=function(t,e,i,r){t.clear();for(var n=0;n<e.width;n++)for(var o=0;o<e.height;o++){var s=e.tiles["".concat(n,",").concat(o)];-1!==r.indexOf("".concat(n,",").concat(o))?(t.draw(n,o,s.char,s.color),s.explored=!0):s.explored&&t.draw(n,o,s.char,F)}var l,a=X(i);try{for(a.s();!(l=a.n()).done;){var h=l.value;-1!==r.indexOf("".concat(h.x,",").concat(h.y))&&t.draw(h.x,h.y,h.char,h.color)}}catch(t){a.e(t)}finally{a.f()}};function q(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var $=function(){function t(e,i,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.x=i,this.y=r,this.char=n,this.color=o}var e,i,r;return e=t,(i=[{key:"move",value:function(t,e){this.x+=t,this.y+=e}}])&&q(e.prototype,i),r&&q(e,r),t}();function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Z(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function J(t,e){return(J=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=it(t);if(e){var n=it(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return et(this,i)}}function et(t,e){return!e||"object"!==Q(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function it(t){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var rt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&J(t,e)}(o,t);var e,i,r,n=tt(o);function o(t,e,i,r,s,l){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(a=n.call(this,e,i,r,s,l)).updateEngine=t,a.initMovement(t),a}return e=o,(i=[{key:"initMovement",value:function(){var t=this;window.addEventListener("keydown",(function(e){var i=t.$handleKeyDown(e.code);i&&t.updateEngine(i)}))}},{key:"$handleKeyDown",value:function(t){var e=[[-1,-1],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]],i=["KeyY","KeyK","KeyU","KeyL","KeyN","KeyJ","KeyB","KeyH"],r=["Numpad7","Numpad8","Numpad9","Numpad6","Numpad3","Numpad2","Numpad1","Numpad4"],n=[null,"ArrowUp",null,"ArrowRight",null,"ArrowDown",null,"ArrowLeft"];return-1!==r.indexOf(t)?{PLAYER_MOVE:e[r.indexOf(t)]}:-1!==n.indexOf(t)?{PLAYER_MOVE:e[n.indexOf(t)]}:-1!==i.indexOf(t)&&{PLAYER_MOVE:e[i.indexOf(t)]}}}])&&Z(e.prototype,i),r&&Z(e,r),o}($);function nt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function ot(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var st=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?nt(Object(i),!0).forEach((function(e){ot(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):nt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},e),r=i.name,n=i.char,o=i.color,s=i.blocksMove,l=i.blocksSight;this.name=r,this.char=n,this.color=o,this.blocksMove=s,this.blocksSight=l,this.explored=!1},lt={"dungeon floor":{name:"dungeon floor",char:".",color:B.SEPIA,blocksMove:!1,blocksSight:!1},"dungeon wall":{name:"dungeon wall",char:"#",color:B.DARK_SEPIA,blocksMove:!0,blocksSight:!0},"forest tree":{name:"forest tree",char:"O",color:B.DARKER_GREEN,blocksMove:!0,blocksSight:!0},"forest grass":{name:"forest grass",char:"^",color:B.DARKER_AMBER,blocksMove:!1,blocksSight:!1}};function at(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ht,ct,ut=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.width=e,this.height=i,this.tiles=this.initTiles()}var e,i,r;return e=t,(i=[{key:"initTiles",value:function(){var t={},e=new Y.Cellular(this.width,this.height);e.randomize(.53);for(var i=0;i<3;i++)e.create((function(e,i,r){t["".concat(e,",").concat(i)]=new st(r?lt["forest grass"]:lt["forest tree"])}));return e.connect((function(e,i,r){t["".concat(e,",").concat(i)]=new st(r?lt["forest tree"]:lt["forest grass"])})),t}},{key:"blocksMoveAt",value:function(t,e){return this.tiles["".concat(t,",").concat(e)].blocksMove}},{key:"addEnemiesToRoom",value:function(t,e){for(var i=randInt(0,3),r=function(i){var r,n=randInt(t.x1+1,t.x2-1),o=randInt(t.y1+1,t.y2-1);e.some((function(t){return t.x===n&&t.y===o}))||(r=randInt(1,100)<=80?new $("orc",n,o,"o",B.DESATURATED_GREEN,!0):new $("troll",n,o,"T",B.DARKER_GREEN,!0),e.push(r))},n=0;n<i;n++)r()}}])&&at(e.prototype,i),r&&at(e,r),t}(),_t=[],ft=function(t,e,i){return _t=[],ht.compute(t,e,i,(function(t,e,i,r){_t.push("".concat(t,",").concat(e))})),_t};ct=new function t(){var e,i,r,n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("PLAYER_MOVE"in t){var e=t.PLAYER_MOVE[0],i=t.PLAYER_MOVE[1],r=n.player.x+e,o=n.player.y+i;n.level.blocksMoveAt(r,o)||(n.player.move(e,i),n.fov.needsRecompute=!0),n.fov.needsRecompute&&(n.fov.map=ft(n.player.x,n.player.y,n.fov.radius))}V(n.mapDisplay,n.level,n.entities,n.fov.map)},(i="update")in(e=this)?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,this.mapDisplay=new D({width:z.MAP_WIDTH,height:z.MAP_HEIGHT,fontFamily:z.fontFamily}),document.querySelector(".canvas-wrapper").appendChild(this.mapDisplay.getContainer());var o,s=Math.floor(z.MAP_WIDTH/2)-1,l=Math.floor(z.MAP_HEIGHT/2)-1;this.player=new rt(this.update,"Player",s,l,"@",B.WHITE),this.entities=[this.player],this.level=new ut(z.MAP_WIDTH,z.MAP_HEIGHT),this.fov={},this.fov.radius=8,o=this.level,ht=new k.PreciseShadowcasting((function(t,e){return o.tiles["".concat(t,",").concat(e)]&&!1===o.tiles["".concat(t,",").concat(e)].blocksSight})),this.fov.map=ft(this.player.x,this.player.y,this.fov.radius),this.fov.needsRecompute=!0,this.update()},window.engine=ct}]);